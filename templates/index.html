<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashflow Kalend√°≈ô</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="app-container">
        <header>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div>
                    <h1>Cashflow Dashboard</h1>
                    <div id="current-datetime"
                        style="font-size: 14px; color: rgba(235, 235, 245, 0.6); margin-top: 4px; font-weight: 500;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="openOverviewModal()"
                        style="background: rgba(255, 255, 255, 0.1); border: 1px solid #ccc; color: #ccc; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        üìä P≈ôehled
                    </button>
                    <button onclick="openInvoiceModal('prijate')"
                        style="background: rgba(255, 82, 82, 0.2); border: 1px solid #ff5252; color: #ff5252; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        üì• P≈ôijat√© faktury
                    </button>
                    <button onclick="openInvoiceModal('vystavene')"
                        style="background: rgba(105, 240, 174, 0.2); border: 1px solid #69f0ae; color: #69f0ae; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        üì§ Vystaven√© faktury
                    </button>
                </div>
            </div>
            <div class="controls" style="display: flex; align-items: center; gap: 15px;">
                <div style="color: var(--text-secondary); font-size: 14px;">
                    P≈ôihl√°≈°en: <strong style="color: var(--text-primary);">{{ user_name }}</strong>
                </div>

                <div style="display: flex; gap: 15px; align-items: center;">
                    <!-- Actual Current Balance -->
                    <div style="display: flex; flex-direction: column; align-items: flex-end; padding: 4px 12px;">
                        <span
                            style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Aktu√°ln√≠
                            stav</span>
                        <span id="display-current-balance"
                            style="font-size: 18px; color: #fff; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">--
                            Kƒç</span>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button onclick="openSettingsModal()"
                        style="background: var(--accent-primary); display: flex; align-items: center; gap: 5px;">
                        ‚öôÔ∏è Nastaven√≠
                    </button>
                    <button onclick="logout()" style="background: rgba(118, 118, 128, 0.24);">
                        Odhl√°sit
                    </button>
                </div>
            </div>
        </header>

        <div class="calendar-grid" id="calendar-grid">
            <!-- Javascript will populate this -->
        </div>
    </div>

    <!-- Modal pre detail d≈àa -->
    <div class="modal-overlay" id="day-modal">
        <div class="modal-content">
            <h3 id="modal-date-title">Detail dne</h3>
            <div id="modal-transactions" class="transaction-list">
                <!-- Transactions go here -->
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()">Zav≈ô√≠t</button>
            </div>
        </div>
    </div>

    <!-- Invoice Modal (Received/Issued) -->
    <div class="modal-overlay" id="invoice-modal" style="display: none;">
        <div class="modal-content"
            style="width: 95%; max-width: 1600px; margin: 20px auto; max-height: 90vh; overflow-y: auto;">
            <h3 id="invoice-modal-title">Fakt√∫ry</h3>
            <div id="invoice-modal-content" style="margin-top: 20px;">
                <!-- Invoice list will be rendered here -->
            </div>
            <div class="modal-footer">
                <button onclick="closeInvoiceModal()">Zavrie≈•</button>
            </div>
        </div>
    </div>

    <!-- Edit Invoice Modal -->
    <div class="modal-overlay" id="edit-invoice-modal" style="display: none; z-index: 1500;">
        <div class="modal-content" style="max-width: 600px;">
            <h3>‚úèÔ∏è Upravit fakt√∫ru</h3>
            <div id="edit-invoice-content" style="margin-top: 20px;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">D√°tum
                            splatnosti</label>
                        <input type="date" id="edit-invoice-date"
                            style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Variabiln√Ω
                            symbol</label>
                        <input type="text" id="edit-invoice-vs" readonly
                            style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Firma</label>
                        <input type="text" id="edit-invoice-party" readonly
                            style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Suma</label>
                        <input type="text" id="edit-invoice-amount" readonly
                            style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px; border-radius: 8px; font-weight: bold;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Popis</label>
                        <textarea id="edit-invoice-desc" readonly rows="3"
                            style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px; border-radius: 8px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="closeEditInvoiceModal()"
                    style="background: transparent; border: 1px solid rgba(255,255,255,0.1);">Zru≈°it</button>
                <button onclick="saveEditedInvoice()"
                    style="background: var(--success-bg); color: #000; font-weight: bold;">üíæ Ulo≈æit</button>
            </div>
        </div>
    </div>

    <!-- Startup Prompt Modal -->
    <div class="modal-overlay" id="startup-prompt-modal" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 450px;">
            <h3>üí∞ Poƒç√°teƒçn√≠ stav √∫ƒçtu</h3>
            <p style="color: var(--text-secondary); margin: 15px 0;">
                Zde m≈Ø≈æete upravit poƒç√°teƒçn√≠ vklad, ze kter√©ho se poƒç√≠t√° aktu√°ln√≠ stav.
            </p>

            <div
                style="background: rgba(118, 118, 128, 0.12); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <label
                    style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 13px;">Poƒç√°teƒçn√≠
                    vklad (Kƒç)</label>
                <input type="number" id="startup-balance-input" value="0"
                    style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: white; padding: 10px; border-radius: 8px; font-size: 18px; font-weight: bold;">
            </div>

            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <input type="checkbox" id="dont-show-startup-again" style="width: 18px; height: 18px; cursor: pointer;">
                <label for="dont-show-startup-again"
                    style="color: var(--text-secondary); cursor: pointer; font-size: 14px;">P≈ô√≠≈°tƒõ nezobrazovat</label>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="closeStartupPrompt(false)"
                    style="background: transparent; border: 1px solid rgba(255,255,255,0.1);">Zru≈°it</button>
                <button onclick="saveStartupBalance()" style="background: var(--accent-primary);">Ulo≈æit a
                    pokraƒçovat</button>
            </div>
        </div>
    </div>


    <!-- Kompletn√Ω settings modal s menu -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content" style="max-width: 1100px; max-height: 90vh; overflow-y: auto;">
            <h3>‚öôÔ∏è Nastaven√≠</h3>

            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px; margin-top: 20px;">
                <!-- ƒΩav√© menu -->
                <div
                    style="background: rgba(118, 118, 128, 0.12); padding: 15px; border-radius: 12px; height: fit-content;">
                    <h4 style="margin-top: 0; font-size: 14px; color: var(--text-secondary);">MENU</h4>
                    <div class="settings-menu">
                        <button onclick="showSettingsTab('general')" class="settings-menu-item active"
                            id="menu-general">
                            üè† Obecn√©
                        </button>
                        <button onclick="showSettingsTab('users')" class="settings-menu-item" id="menu-users">
                            üë• Spr√°va u≈æivatel≈Ø
                        </button>
                        <button onclick="showSettingsTab('import')" class="settings-menu-item" id="menu-import">
                            üì• Import faktur
                        </button>
                        <button onclick="showSettingsTab('files')" class="settings-menu-item" id="menu-files">
                            üìÅ Kontrola soubor≈Ø
                        </button>
                        <button onclick="showSettingsTab('flexibee')" class="settings-menu-item" id="menu-flexibee">
                            üîÑ FlexiBee API
                        </button>
                        <button onclick="showSettingsTab('backup')" class="settings-menu-item" id="menu-backup">
                            üíæ Spr√°va DB
                        </button>
                        <button onclick="showSettingsTab('server')" class="settings-menu-item" id="menu-server">
                            üîß Server
                        </button>
                        <button onclick="showSettingsTab('help')" class="settings-menu-item" id="menu-help">
                            ‚ùì N√°povƒõda
                        </button>
                        <button onclick="showSettingsTab('logs')" class="settings-menu-item" id="menu-logs">
                            üìú Logy
                        </button>
                    </div>
                </div>

                <!-- Prav√Ω obsah -->
                <div id="settings-content" style="min-height: 500px;">
                    <!-- TAB: Obecn√© -->
                    <div id="tab-general" class="settings-tab">
                        <h4>Obecn√° nastaven√≠</h4>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h5 style="margin-top: 0;">üí∞ Poƒç√°teƒçn√≠ stav √∫ƒçtu</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 10px;">
                                Ruƒçn√≠ zmƒõna poƒç√°teƒçn√≠ho vkladu.
                            </p>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="settings-initial-balance" value="0"
                                    style="width: 150px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: white; padding: 8px; border-radius: 6px;">
                                <button onclick="updateInitialBalanceFromSettings()"
                                    style="background: var(--success-bg);">Ulo≈æit</button>
                            </div>
                        </div>

                        <div style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px;">
                            <h5 style="margin-top: 0;">üëã Uv√≠tac√≠ okno</h5>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <p style="color: var(--text-secondary); margin: 0;">Pokud jste skryli uv√≠tac√≠ okno,
                                    m≈Ø≈æete ho zde resetovat.</p>
                                <button onclick="resetStartupPrompt()"
                                    style="font-size: 12px; padding: 6px 12px;">Resetovat zobrazen√≠</button>
                            </div>
                        </div>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-top: 20px;">
                            <h5 style="margin-top: 0;">üîë Zmƒõna hesla</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px; font-size:14px;">Zmƒõna hesla
                                pro pr√°vƒõ p≈ôihl√°≈°en√©ho u≈æivatele.</p>
                            <div style="display: grid; gap: 10px; max-width: 350px;">
                                <input type="password" id="cp-old" placeholder="Star√© heslo"
                                    style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px; border-radius: 6px;">
                                <input type="password" id="cp-new" placeholder="Nov√© heslo"
                                    style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px; border-radius: 6px;">
                                <input type="password" id="cp-new-confirm" placeholder="Potvrzen√≠ nov√©ho hesla"
                                    style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px; border-radius: 6px;">
                                <button onclick="changePassword()"
                                    style="background: var(--accent-primary); color:white; border:none; padding:8px; border-radius:6px; cursor:pointer;">Zmƒõnit
                                    heslo</button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: Spr√°va u≈æivatel≈Ø -->
                    <div id="tab-users" class="settings-tab">
                        <h4>Spr√°va u≈æivatel≈Ø</h4>
                        <div style="margin-bottom: 20px;">
                            <button onclick="showAddUserForm()" style="background: var(--success-bg);">+ P≈ôidat
                                u≈æivatele</button>
                        </div>

                        <div id="add-user-form"
                            style="display: none; background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h4 style="margin-top: 0;">Nov√Ω u≈æivatel</h4>
                            <div style="display: grid; gap: 15px;">
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 5px; color: var(--text-secondary);">U≈æivatelsk√©
                                        jm√©no</label>
                                    <input type="text" id="new-username"
                                        style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Cel√©
                                        jm√©no</label>
                                    <input type="text" id="new-name"
                                        style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Heslo</label>
                                    <input type="password" id="new-password"
                                        style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Role</label>
                                    <select id="new-role"
                                        style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                        <option value="user">U≈æivatel</option>
                                        <option value="admin">Administr√°tor</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="createUser()"
                                        style="background: var(--success-bg);">Vytvo≈ôit</button>
                                    <button onclick="hideAddUserForm()">Zru≈°it</button>
                                </div>
                            </div>
                        </div>

                        <div id="users-list" class="transaction-list" style="max-height: 400px;"></div>
                    </div>

                    <!-- TAB: Import faktur -->
                    <div id="tab-import" class="settings-tab" style="display: none;">
                        <h4>Import faktur</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            Nahrajte XLSX soubory s fakturami. Nov√© soubory se p≈ôidaj√≠ k existuj√≠c√≠m dat≈Øm.
                        </p>

                        <div style="display: grid; gap: 20px;">
                            <div style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px;">
                                <h5 style="margin-top: 0;">üì• P≈ôijat√© faktury</h5>
                                <p style="color: var(--text-secondary); font-size: 14px;">Faktury kter√© jste dostali
                                    (mus√≠te zaplatit)</p>
                                <button onclick="document.getElementById('settings-file-prijate').click()"
                                    style="background: var(--accent-primary);">
                                    Vybrat soubor
                                </button>
                                <input type="file" id="settings-file-prijate" hidden accept=".xlsx,.xls"
                                    onchange="handleFileUpload(this, 'prijate')">
                            </div>

                            <div style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px;">
                                <h5 style="margin-top: 0;">üì§ Vydan√© faktury</h5>
                                <p style="color: var(--text-secondary); font-size: 14px;">Faktury kter√© jste vystavili
                                    (dostanete zaplaceno)</p>
                                <button onclick="document.getElementById('settings-file-vydane').click()"
                                    style="background: var(--accent-primary);">
                                    Vybrat soubor
                                </button>
                                <input type="file" id="settings-file-vydane" hidden accept=".xlsx,.xls"
                                    onchange="handleFileUpload(this, 'vydane')">
                            </div>
                        </div>
                    </div>

                    <!-- TAB: Kontrola soubor≈Ø -->
                    <div id="tab-files" class="settings-tab" style="display: none;">
                        <h4>Kontrola nahran√Ωch soubor≈Ø</h4>
                        <button onclick="loadUploadedFiles()" style="margin-bottom: 20px;">üîÑ Obnovit seznam</button>

                        <div style="display: grid; gap: 20px;">
                            <div>
                                <h5>üì• P≈ôijat√© faktury</h5>
                                <div id="files-prijate-list"
                                    style="background: rgba(118, 118, 128, 0.12); padding: 15px; border-radius: 8px; min-height: 100px;">
                                    <p style="color: var(--text-secondary);">Naƒç√≠t√°n√≠...</p>
                                </div>
                            </div>

                            <div>
                                <h5>üì§ Vydan√© faktury</h5>
                                <div id="files-vydane-list"
                                    style="background: rgba(118, 118, 128, 0.12); padding: 15px; border-radius: 8px; min-height: 100px;">
                                    <p style="color: var(--text-secondary);">Naƒç√≠t√°n√≠...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: Spr√°va DB (z√°lohy) -->
                    <div id="tab-backup" class="settings-tab" style="display: none;">
                        <h4>Spr√°va datab√°ze a z√°loh</h4>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h5 style="margin-top: 0;">üíæ Vytvo≈ôit z√°lohu</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                                Vytvo≈ô√≠ okam≈æitou z√°lohu datab√°ze vƒçetnƒõ v≈°ech transakc√≠, u≈æivatel≈Ø a nastaven√≠.
                            </p>
                            <button onclick="createBackup()" style="background: var(--success-bg);">
                                üíæ Vytvo≈ôit z√°lohu nyn√≠
                            </button>
                        </div>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h5 style="margin-top: 0;">üì§ Nahr√°t z√°lohu</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                                Nahrajte soubor z√°lohy (.db) a obnovte data. Aktu√°ln√≠ data budou p≈ôeps√°na!
                            </p>
                            <input type="file" id="backup-file-input" accept=".db"
                                style="margin-bottom: 15px; width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; color: #fff;">
                            <br>
                            <button onclick="restoreBackup()" style="background: var(--accent-primary);">
                                üì§ Nahr√°t a obnovit
                            </button>
                        </div>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h5 style="margin: 0;">üìã Dostupn√© z√°lohy</h5>
                                <button onclick="loadBackups()" style="padding: 6px 12px; font-size: 12px;">
                                    üîÑ Obnovit seznam
                                </button>
                            </div>
                            <div id="backup-list" style="max-height: 300px; overflow-y: auto;">
                                <p style="color: var(--text-secondary);">Naƒç√≠t√°n√≠...</p>
                            </div>
                        </div>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h5 style="margin-top: 0;">‚è∞ Automatick√© z√°lohy</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                                Nastavte automatick√© vytv√°≈ôen√≠ z√°loh v pravideln√Ωch intervalech.
                            </p>

                            <div style="display: grid; gap: 15px;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox" id="backup-enabled" style="width: 20px; height: 20px;">
                                        <span>Povolit automatick√© z√°lohy</span>
                                    </label>
                                </div>

                                <div>
                                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                                        Interval (hodiny)
                                    </label>
                                    <input type="number" id="backup-interval" value="24" min="1" max="168" style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); 
                                                  color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                    <small style="color: var(--text-secondary);">Doporuƒçeno: 24 hodin (dennƒõ)</small>
                                </div>

                                <div>
                                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                                        Maxim√°ln√≠ poƒçet z√°loh
                                    </label>
                                    <input type="number" id="backup-max" value="30" min="5" max="100" style="width: 100%; background: rgba(118, 118, 128, 0.12); border: 1px solid var(--border-color); 
                                                  color: var(--text-primary); padding: 10px; border-radius: 8px;">
                                    <small style="color: var(--text-secondary);">Star≈°√≠ z√°lohy budou automaticky
                                        smaz√°ny</small>
                                </div>

                                <div>
                                    <button onclick="saveBackupConfig()" style="background: var(--success-bg);">
                                        üíæ Ulo≈æit konfiguraci
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div
                            style="background: rgba(255, 69, 58, 0.1); border: 1px solid var(--danger-bg); padding: 20px; border-radius: 12px;">
                            <h5 style="margin-top: 0; color: var(--danger-bg);">‚ö†Ô∏è Nebezpeƒçn√° z√≥na</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                                Vyma≈æe v≈°echny transakce a poƒç√°teƒçn√≠ stav √∫ƒçtu. Tuto operaci nelze vr√°tit zpƒõt!
                            </p>
                            <button onclick="confirmResetDB()" style="background: var(--danger-bg);">
                                üóëÔ∏è Vymazat datab√°zi
                            </button>
                        </div>
                    </div>


                    <!-- TAB: FlexiBee (NEW) -->
                    <div id="tab-flexibee" class="settings-tab" style="display: none;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4 style="margin: 0;">üîÑ FlexiBee Integrace</h4>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button onclick="window.open('/flexibee/help', '_blank')"
                                    style="background: var(--accent-primary); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">
                                    üìñ N√°povƒõda
                                </button>
                                <span id="flexibee-status"
                                    style="font-size: 12px; padding: 4px 8px; border-radius: 4px; background: #333; color: #aaa;">Neaktivn√≠</span>
                            </div>
                        </div>

                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h5 style="margin-top: 0; margin-bottom: 15px; color: var(--accent-primary);">üîê P≈ôipojen√≠ k
                                API</h5>

                            <div style="display: grid; gap: 15px;">
                                <div>
                                    <label
                                        style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">URL
                                        Serveru (vƒçetnƒõ protokolu a portu)</label>
                                    <input type="text" id="fb-host" placeholder="https://demo.flexibee.eu:5434"
                                        style="width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 6px; color: #fff;">
                                </div>

                                <div>
                                    <label
                                        style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">Identifik√°tor
                                        firmy</label>
                                    <input type="text" id="fb-company" placeholder="demo_sro"
                                        style="width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 6px; color: #fff;">
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label
                                            style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">API
                                            U≈æivatel</label>
                                        <input type="text" id="fb-user"
                                            style="width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 6px; color: #fff;">
                                    </div>
                                    <div>
                                        <label
                                            style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">API
                                            Heslo</label>
                                        <input type="password" id="fb-password"
                                            style="width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 6px; color: #fff;">
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button onclick="testFlexiBeeConnection()"
                                    style="background: #333; border: 1px solid var(--border-color); color: #fff; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                                    üì° Otestovat p≈ôipojen√≠
                                </button>
                                <button onclick="saveFlexiBeeConfig()"
                                    style="background: var(--success-bg); border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; color: #000; font-weight: bold;">
                                    üíæ Ulo≈æit nastaven√≠
                                </button>
                            </div>
                        </div>

                        <div style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px;">
                            <h5 style="margin-top: 0; margin-bottom: 15px;">‚öôÔ∏è Synchronizace</h5>

                            <div style="margin-bottom: 20px;">
                                <label
                                    style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 15px;">
                                    <input type="checkbox" id="fb-enabled" style="width: 18px; height: 18px;">
                                    <span>Povolit automatickou synchronizaci (ka≈ædou hodinu)</span>
                                </label>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label
                                    style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">
                                    üìÖ Importovat faktury od data
                                </label>
                                <input type="date" id="fb-import-from-date"
                                    style="width: 100%; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 6px; color: #fff;">
                                <small style="color: var(--text-secondary); font-size: 11px;">
                                    Pokud nen√≠ vyplnƒõno, importuj√≠ se faktury za posledn√≠ch 365 dn√≠
                                </small>
                            </div>

                            <div
                                style="display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                                <div>
                                    <div style="font-weight: bold; color: #fff;">Manu√°ln√≠ synchronizace</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">St√°hne zmƒõny od posledn√≠
                                        synchronizace.</div>
                                </div>
                                <button id="fb-sync-btn" onclick="runFlexiBeeSync()"
                                    style="background: var(--accent-primary); border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; color: #000; font-weight: bold;">
                                    üöÄ Spustit nyn√≠
                                </button>
                            </div>
                            <div id="fb-sync-log"
                                style="margin-top: 15px; font-family: monospace; font-size: 12px; color: #aaa; max-height: 100px; overflow-y: auto;">
                            </div>
                        </div>
                    </div>

                    <!-- TAB: Server -->
                    <div id="tab-server" class="settings-tab" style="display: none;">
                        <h4>Spr√°va serveru</h4>
                        <div style="background: rgba(118, 118, 128, 0.12); padding: 20px; border-radius: 12px;">
                            <h5 style="margin-top: 0;">üîÑ Restart serveru</h5>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                                Restartuje aplikaƒçn√≠ server. V≈°ichni u≈æivatel√© budou odpojeni.
                            </p>
                            <button onclick="confirmRestartServer()" style="background: var(--accent-primary);">
                                üîÑ Restartovat server
                            </button>
                        </div>
                    </div>

                    <!-- TAB: Pomoc / N√°povƒõda -->
                    <div id="tab-help" class="settings-tab" style="display: none;">
                        <h4>‚ùì N√°povƒõda a Dokumentace</h4>
                        <div
                            style="background: rgba(118, 118, 128, 0.12); padding: 25px; border-radius: 12px; line-height: 1.6; color: var(--text-secondary); max-height: 600px; overflow-y: auto;">

                            <h5
                                style="color: var(--text-primary); margin-top: 0; font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üìä Hlavn√° str√°nka</h5>
                            <p style="margin-bottom: 15px;">
                                Zobrazuje <strong>len prijat√© fakt√∫ry (v√Ωdaje)</strong> - dni, kedy m√°te splatn√© platby.
                            </p>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Kliknut√≠m na riadok</strong> zobraz√≠te detail
                                    d≈àa vr√°tane zoznamu fakt√∫r (VS, firma, suma)</li>
                                <li style="margin-bottom: 8px;"><strong>ƒåerven√Ω zostatok</strong> = dlh,
                                    <strong>zelen√Ω</strong> = prebytok
                                </li>
                                <li><strong>Aktu√°ln√≠ stav:</strong> V pravom hornom rohu vid√≠te aktu√°lny vypoƒç√≠tan√Ω
                                    zostatok k dne≈°n√©mu d≈àu.</li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üîò Tlaƒçidl√° v hlaviƒçke</h5>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>üìä Prehƒæad</strong> - Kompletn√Ω zoznam v≈°etk√Ωch
                                    transakci√≠ (pr√≠jmy + v√Ωdaje)</li>
                                <li style="margin-bottom: 8px;"><strong>üì• Prijat√© fakt√∫ry</strong> - Zoznam v√Ωdajov s
                                    mo≈ænos≈•ou √∫pravy d√°tumu splatnosti a pridania nov√Ωch</li>
                                <li><strong>üì§ Vystaven√© fakt√∫ry</strong> - Zoznam pr√≠jmov s mo≈ænos≈•ou pridania
                                    (fakt√∫ra/vklad/in√©)</li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üì• Prijat√© fakt√∫ry (V√Ωdaje)</h5>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>‚ûï Prida≈• v√Ωdaj</strong> - Manu√°lne pridanie
                                    novej prijatej fakt√∫ry</li>
                                <li style="margin-bottom: 8px;"><strong>‚úèÔ∏è Upravi≈•</strong> - Zmena d√°tumu splatnosti
                                    (presunutie na de≈à, kedy m√°te peniaze)</li>
                                <li style="margin-bottom: 8px;"><strong>üóëÔ∏è Zmaza≈•</strong> - Odstr√°nenie fakt√∫ry</li>
                                <li>V√Ωdaje sa <strong>automaticky zapoƒç√≠tavaj√∫ v de≈à splatnosti</strong></li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üì§ Vystaven√© fakt√∫ry (Pr√≠jmy)</h5>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>‚ûï Prida≈• pr√≠jem</strong> - V√Ωber typu: Vystaven√°
                                    fakt√∫ra / Vklad / In√©</li>
                                <li style="margin-bottom: 8px;"><strong>üóëÔ∏è Zmaza≈•</strong> - Odstr√°nenie fakt√∫ry</li>
                                <li style="margin-bottom: 8px;">Pr√≠jmy sa <strong>automaticky zapoƒç√≠tavaj√∫ v de≈à
                                        splatnosti</strong></li>
                                <li>Stav "zaplaceno/nezaplaceno" u≈æ nie je potrebn√Ω</li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üí° Logika v√Ωpoƒçtu zostatku</h5>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Pr√≠jmy</strong> - Zapoƒç√≠tavaj√∫ sa v de≈à
                                    splatnosti</li>
                                <li style="margin-bottom: 8px;"><strong>V√Ωdaje</strong> - Zapoƒç√≠tavaj√∫ sa v de≈à
                                    splatnosti</li>
                                <li style="margin-bottom: 8px;"><strong>Arch√≠v</strong> - Transakcie oznaƒçen√© ako
                                    "archiv" sa ignoruj√∫</li>
                                <li><strong>Kumulovan√Ω stav</strong> - Be≈æn√Ω zostatok od zaƒçiatku (Poƒçiatoƒçn√Ω stav +
                                    v≈°etky transakcie)</li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                üì• Import a Data</h5>
                            <p style="margin-bottom: 15px;">
                                Data do aplikace dostanete nahr√°n√≠m Excel soubor≈Ø (XLSX) v sekci <strong>Nastaven√≠ ->
                                    Import faktur</strong>.
                            </p>
                            <ul style="margin-bottom: 25px; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>P≈ôijat√© faktury (V√Ωdaje):</strong> Nahr√°vejte
                                    faktury od dodavatel≈Ø. Syst√©m automaticky kontroluje <strong>Variabiln√≠ Symboly
                                        (VS)</strong>. Pokud se pokus√≠te nahr√°t fakturu se stejn√Ωm VS znovu, syst√©m ji
                                    inteligentnƒõ p≈ôeskoƒç√≠ a upozorn√≠ v√°s na duplicitu.</li>
                                <li style="margin-bottom: 8px;"><strong>Vydan√© faktury (P≈ô√≠jmy):</strong> Nahr√°vejte
                                    faktury, kter√© jste vystavili vy.</li>
                                <li><strong>Poƒç√°teƒçn√≠ stav:</strong> V sekci <em>Nastaven√≠ -> Obecn√©</em> zadejte
                                    ƒç√°stku, se kterou zaƒç√≠n√°te, aby sedƒõly celkov√© souƒçty.</li>
                            </ul>

                            <h5
                                style="color: var(--text-primary); font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px;">
                                ‚öôÔ∏è Spr√°va syst√©mu</h5>
                            <ul style="margin-bottom: 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Spr√°va DB (Z√°lohy):</strong> Velmi d≈Øle≈æit√©! Zde
                                    m≈Ø≈æete vytv√°≈ôet z√°lohy cel√© datab√°ze. Doporuƒçujeme to dƒõlat pravidelnƒõ p≈ôed velk√Ωmi
                                    importy.</li>
                                <li style="margin-bottom: 8px;"><strong>Kontrola soubor≈Ø:</strong> Zde vid√≠te seznam
                                    v≈°ech nahran√Ωch soubor≈Ø. Pokud jste nahr√°li nƒõco omylem, m≈Ø≈æete to zde smazat
                                    (pozor, sma≈æe to i transakce).</li>
                                <li><strong>U≈æivatel√©:</strong> Administr√°tor m≈Ø≈æe p≈ôid√°vat dal≈°√≠ u≈æivatele s r≈Øzn√Ωmi
                                    pr√°vy.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TAB: Logy / Audit -->
                    <div id="tab-logs" class="settings-tab" style="display: none;">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h4 style="margin:0">üìú Audit Log (Posledn√≠ch 100 akc√≠)</h4>
                            <button onclick="loadAuditLog()"
                                style="padding:5px 10px; font-size:12px; background:rgba(255,255,255,0.1)">üîÑ
                                Obnovit</button>
                        </div>
                        <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <thead>
                                    <tr style="text-align: left; background: rgba(255,255,255,0.05);">
                                        <th style="padding: 8px;">ƒåas</th>
                                        <th style="padding: 8px;">U≈æivatel</th>
                                        <th style="padding: 8px;">Akce</th>
                                        <th style="padding: 8px;">Detaily</th>
                                    </tr>
                                </thead>
                                <tbody id="audit-log-list">
                                    <!-- Fetched data -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal-footer">
                <button onclick="closeSettingsModal()">Zav≈ô√≠t</button>
            </div>
        </div>
    </div>

    <!-- CSS ≈°t√Ωly pre menu -->
    <style>
        .settings-menu {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .settings-menu-item {
            background: transparent;
            border: none;
            padding: 12px 15px;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: none;
        }

        .settings-menu-item:hover {
            background: rgba(118, 118, 128, 0.18);
            color: var(--text-primary);
            transform: none;
        }

        .settings-menu-item.active {
            background: var(--accent-primary);
            color: white;
        }

        .settings-tab {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <script src="/static/flexibee.js"></script>
    <script src="/static/script.js?v=2"></script>
</body>

</html>